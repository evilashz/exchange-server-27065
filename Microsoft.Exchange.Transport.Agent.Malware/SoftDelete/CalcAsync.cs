using System;
using System.Threading;

namespace Microsoft.Exchange.Transport.Agent.Malware.SoftDelete
{
	// Token: 0x0200000C RID: 12
	internal class CalcAsync : IAsyncResult
	{
		// Token: 0x06000029 RID: 41 RVA: 0x00003BB3 File Offset: 0x00001DB3
		public CalcAsync(AsyncCallback asyncCallback, object state)
		{
			this.asyncCallback = asyncCallback;
			this.asyncState = state;
		}

		// Token: 0x17000001 RID: 1
		// (get) Token: 0x0600002A RID: 42 RVA: 0x00003BC9 File Offset: 0x00001DC9
		public object AsyncState
		{
			get
			{
				return this.asyncState;
			}
		}

		// Token: 0x17000002 RID: 2
		// (get) Token: 0x0600002B RID: 43 RVA: 0x00003BD1 File Offset: 0x00001DD1
		public bool CompletedSynchronously
		{
			get
			{
				return Thread.VolatileRead(ref this.completedState) == 1;
			}
		}

		// Token: 0x17000003 RID: 3
		// (get) Token: 0x0600002C RID: 44 RVA: 0x00003BE4 File Offset: 0x00001DE4
		public WaitHandle AsyncWaitHandle
		{
			get
			{
				if (this.asyncWaitHandle == null)
				{
					lock (CalcAsync.sync)
					{
						bool isCompleted = this.IsCompleted;
						if (this.asyncWaitHandle == null)
						{
							ManualResetEvent manualResetEvent = new ManualResetEvent(isCompleted);
							this.asyncWaitHandle = manualResetEvent;
						}
						else if (!isCompleted && this.IsCompleted)
						{
							this.asyncWaitHandle.Set();
						}
					}
				}
				return this.asyncWaitHandle;
			}
		}

		// Token: 0x17000004 RID: 4
		// (get) Token: 0x0600002D RID: 45 RVA: 0x00003C64 File Offset: 0x00001E64
		public bool IsCompleted
		{
			get
			{
				return Thread.VolatileRead(ref this.completedState) != 0;
			}
		}

		// Token: 0x0600002E RID: 46 RVA: 0x00003C78 File Offset: 0x00001E78
		public void SetAsCompleted(Exception exception, bool completedSynchronously)
		{
			this.exception = exception;
			int num = Interlocked.Exchange(ref this.completedState, completedSynchronously ? 1 : 2);
			if (num != 0)
			{
				throw new InvalidOperationException("You can set a result only once");
			}
			if (this.asyncWaitHandle != null)
			{
				this.asyncWaitHandle.Set();
			}
			if (this.asyncCallback != null)
			{
				this.asyncCallback(this);
			}
		}

		// Token: 0x0600002F RID: 47 RVA: 0x00003CD5 File Offset: 0x00001ED5
		public void EndInvoke()
		{
			if (!this.IsCompleted)
			{
				this.AsyncWaitHandle.WaitOne();
				this.asyncWaitHandle.Close();
				this.asyncWaitHandle = null;
			}
			if (this.exception != null)
			{
				throw this.exception;
			}
		}

		// Token: 0x04000008 RID: 8
		private const int StatePending = 0;

		// Token: 0x04000009 RID: 9
		private const int StateCompletedSynchronously = 1;

		// Token: 0x0400000A RID: 10
		private const int StateCompletedAsynchronously = 2;

		// Token: 0x0400000B RID: 11
		private static object sync = new object();

		// Token: 0x0400000C RID: 12
		private readonly AsyncCallback asyncCallback;

		// Token: 0x0400000D RID: 13
		private readonly object asyncState;

		// Token: 0x0400000E RID: 14
		private int completedState;

		// Token: 0x0400000F RID: 15
		private ManualResetEvent asyncWaitHandle;

		// Token: 0x04000010 RID: 16
		private Exception exception;
	}
}
