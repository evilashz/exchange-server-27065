using System;
using Microsoft.Exchange.Data.Directory.SystemConfiguration;

namespace Microsoft.Exchange.Transport.Agent.Malware.Actions
{
	// Token: 0x02000005 RID: 5
	internal class ActionDeferForever : ActionDefer
	{
		// Token: 0x06000012 RID: 18 RVA: 0x00002E78 File Offset: 0x00001078
		protected override bool AreAnyDeferralsLeft(StampDefer stamp, ScanContext context)
		{
			bool result = true;
			if (MalwareScanErrorAction.Allow == context.AgentGlobal.ServerSettings.ScanErrorAction && stamp.DeferredCount >= context.AgentGlobal.ServerSettings.DeferAttempts)
			{
				result = false;
			}
			return result;
		}

		// Token: 0x06000013 RID: 19 RVA: 0x00002EB5 File Offset: 0x000010B5
		protected override void UpdateStamp(StampDefer stamp)
		{
			stamp.MaxDeferredCount = -1;
		}

		// Token: 0x06000014 RID: 20 RVA: 0x00002EC0 File Offset: 0x000010C0
		protected override StampDefer CreateNewStamp(ScanContext context)
		{
			double num = (context.OverrideWaitTime.TotalMinutes == 0.0) ? ((double)context.AgentGlobal.ServerSettings.DeferWaitTime) : context.OverrideWaitTime.TotalMinutes;
			double waitTimeMinutes = Math.Min(num, Constants.MinutesPerDay);
			return new StampDefer(1, -1, num, StampDefer.GetRandomizedWaitTime(waitTimeMinutes), typeof(ActionDeferForever), context.IsCrashRecoverable, context.IsTimeoutRecoverable);
		}
	}
}
