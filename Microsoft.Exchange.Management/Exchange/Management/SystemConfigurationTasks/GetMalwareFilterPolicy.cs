using System;
using System.Management.Automation;
using Microsoft.Exchange.Configuration.Tasks;
using Microsoft.Exchange.Data;
using Microsoft.Exchange.Data.Directory;
using Microsoft.Exchange.Data.Directory.SystemConfiguration;

namespace Microsoft.Exchange.Management.SystemConfigurationTasks
{
	// Token: 0x02000A82 RID: 2690
	[Cmdlet("Get", "MalwareFilterPolicy", DefaultParameterSetName = "Identity")]
	public sealed class GetMalwareFilterPolicy : GetMultitenancySystemConfigurationObjectTask<MalwareFilterPolicyIdParameter, MalwareFilterPolicy>
	{
		// Token: 0x17001CD2 RID: 7378
		// (get) Token: 0x06005F8A RID: 24458 RVA: 0x0018FE9E File Offset: 0x0018E09E
		// (set) Token: 0x06005F8B RID: 24459 RVA: 0x0018FEA6 File Offset: 0x0018E0A6
		[Parameter]
		public SwitchParameter IgnoreDehydratedFlag { get; set; }

		// Token: 0x17001CD3 RID: 7379
		// (get) Token: 0x06005F8C RID: 24460 RVA: 0x0018FEAF File Offset: 0x0018E0AF
		// (set) Token: 0x06005F8D RID: 24461 RVA: 0x0018FEB7 File Offset: 0x0018E0B7
		[Parameter]
		public SwitchParameter IncludeInvalidPolicies { private get; set; }

		// Token: 0x17001CD4 RID: 7380
		// (get) Token: 0x06005F8E RID: 24462 RVA: 0x0018FEC0 File Offset: 0x0018E0C0
		protected override bool DeepSearch
		{
			get
			{
				return true;
			}
		}

		// Token: 0x17001CD5 RID: 7381
		// (get) Token: 0x06005F8F RID: 24463 RVA: 0x0018FEC3 File Offset: 0x0018E0C3
		protected override SharedTenantConfigurationMode SharedTenantConfigurationMode
		{
			get
			{
				if (!this.IgnoreDehydratedFlag)
				{
					return SharedTenantConfigurationMode.Dehydrateable;
				}
				return SharedTenantConfigurationMode.NotShared;
			}
		}

		// Token: 0x17001CD6 RID: 7382
		// (get) Token: 0x06005F90 RID: 24464 RVA: 0x0018FED8 File Offset: 0x0018E0D8
		protected override QueryFilter InternalFilter
		{
			get
			{
				QueryFilter queryFilter = new ComparisonFilter(ComparisonOperator.Equal, ADObjectSchema.ExchangeVersion, ExchangeObjectVersion.Exchange2012);
				if (base.InternalFilter != null)
				{
					return new AndFilter(new QueryFilter[]
					{
						base.InternalFilter,
						queryFilter
					});
				}
				return queryFilter;
			}
		}

		// Token: 0x06005F91 RID: 24465 RVA: 0x0018FF1C File Offset: 0x0018E11C
		protected override IConfigDataProvider CreateSession()
		{
			IConfigDataProvider configDataProvider = base.CreateSession();
			if (configDataProvider != null)
			{
				IDirectorySession directorySession = configDataProvider as IDirectorySession;
				if (directorySession != null && directorySession.SessionSettings != null && !this.IncludeInvalidPolicies)
				{
					directorySession.SessionSettings.IncludeCNFObject = false;
				}
			}
			return configDataProvider;
		}
	}
}
